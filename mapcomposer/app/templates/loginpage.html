<% extends ./base.html %>
<% subskin extrahead %>
    <!-- OpenLayers resources -->
    <link rel="stylesheet" type="text/css" href="externals/openlayers/theme/default/style.css">

	<!-- Basic OpenLayers libs -->
    <script type="text/javascript" src="script/OpenLayers.js"></script>		
	
	<!-- Externatls OpenLayers libraries to manage other extensions -->
	<script type="text/javascript" src="script/OpenLayersExt.js"></script> 
    
    <!-- Ask RingoJS for debug status -->
    <script type="text/javascript" src="debug.js"></script> 
	
	<link rel="stylesheet" type="text/css" href="theme/app/openlayers.css" />
	
	<!-- colorpicker resources 
    <link rel="stylesheet" type="text/css" href="externals/colorpicker/css/colorpicker.css">
    <script type="text/javascript" src="script/colorpicker.js"></script> -->
	
    <!-- GeoExt resources -->
    <link rel="stylesheet" type="text/css" href="externals/GeoExt/resources/css/popup.css">
    <link rel="stylesheet" type="text/css" href="externals/GeoExt/resources/css/layerlegend.css">
    <link rel="stylesheet" type="text/css" href="externals/GeoExt/resources/css/gxtheme-gray.css">	
    <script type="text/javascript" src="script/GeoExt.js"></script> 	
	
	<script type="text/javascript" src="script/GeoExtExt.js"></script>
	
	<!-- PrintPreview resources  	
    <link rel="stylesheet" type="text/css" href="externals/PrintPreview/resources/css/printpreview.css">
    <script type="text/javascript" src="script/PrintPreview.js"></script>-->
	
    <!-- canvg-1.2 resources -->
	<script type="text/javascript" src="script/canvg-1.2.js"></script> 
	
    <!-- gxp resources -->
    <link rel="stylesheet" type="text/css" href="externals/gxp/src/theme/all.css">

    <script type="text/javascript" src="script/gxp.js"></script> 

    <!--script type="text/javascript" src="script/proj4js.js"></script-->
	<!--script type="text/javascript" src="script/projCodes.js"></script-->

    <!-- GeoExplorer resources -->
    <link rel="stylesheet" type="text/css" href="theme/app/geoexplorer.css" />
    <link rel="stylesheet" type="text/css" href="theme/app/mapstore.css" />
    <link rel="stylesheet" type="text/css" href="theme/app/custom.css" />
	
	<!-- Advanced Scalebar CSS -->
	<!--link rel="stylesheet" type="text/css" href="theme/app/scalebar-fat.css" /-->
    <link rel="stylesheet" type="text/css" href="theme/app/scalebar-thin.css" />
    <!--[if IE]><link rel="stylesheet" type="text/css" href="theme/app/ie.css"/><![endif]-->        

    <script type="text/javascript" src="script/GeoExplorer.js"></script>
    <script type="text/javascript" src="script/ux.js"></script>
   
    <!-- csw resources -->
    <link rel="stylesheet" type="text/css" href="externals/csw/css/csw.css">
    <script type="text/javascript" src="auth/base64.js"></script>

    <!-- common data  -->
    <script type="text/javascript" src="config/common/localConfig.js"></script>
    
	<!-- translation data  -->
    <script type="text/javascript" src="translations/en.js"></script>
    <script type="text/javascript" src="translations/fr.js"></script>
    <script type="text/javascript" src="translations/it.js"></script>
    <script type="text/javascript" src="translations/de.js"></script>
    <script type="text/javascript" src="translations/es.js"></script>
	
	<!-- uncomment to have  welcome screen
	<script type="text/javascript">
	 
        Ext.onReady(function() {
          setTimeout(function(){
            Ext.get('loading').remove();
            Ext.get('loading-mask').fadeOut({remove:true,duration:1});
          }, 2000);
        });
   
    </script>
    
    <div id="loading-mask"></div>
    <div id="loading">
      <div class="loading-indicator">
      </div>
    </div>
	-->
	
    <script>
		var app;        
        var modified = false; var mapIdentifier = -1; var authorization = false; var fullScreen = false; var bbox; var useCookies;
		
		// /////////////////////////////////////////////////////
		// Extra parameters to add layers at startup
		// /////////////////////////////////////////////////////
		var layName; var layTitle; var wmsurl; var gsturl;
		
        // ///////////////////////////////////////////////////////////////
        // Custom variables from the mapStoreConfig user configuration file 
        // ///////////////////////////////////////////////////////////////
        var proxy; 
        var serverConfig;
        var customConfigName;		
        // //////////////////////////////////////////////////
        // Parsing the request to get the parameters
        // //////////////////////////////////////////////////
        var params = location.search.replace(/^\?/,'').replace(/&amp;/g,'&').split("&");
        for (var j=0; j < params.length; j++) {
			var param = params[j].split("=");
			if(param[0]){
				switch ( param[0] ) {
					case "mapId": 
									try{
										mapIdentifier = parseInt(param[1]);
									}catch(e){
										mapIdentifier = -1;
									} 
									break;
					case "auth" : 
									if(param[1] == 'true') 
										authorization = true; 
									else 
										authorization = false; 
									break;
					case "fullScreen" : 
									if(param[1] == 'true') 
										fullScreen = true; 
									else 
										fullScreen = false; 
									break;
					case "layName" : 
									layName = param[1]; 
									break;
					case "layTitle" : 
									layTitle = param[1]; 
									break;
					case "wmsurl" : 
									wmsurl = param[1]; 
									wmsurl = decodeURIComponent(wmsurl);
									break;
					case "gsturl" : 
									gsturl = param[1]; 
									gsturl = decodeURIComponent(gsturl);
									break;
					case "useCookies" : 
									useCookies = param[1]; 
									break;
					case "config":	
									customConfigName = param[1];
									break;
					case "bbox": 
									try{
										bbox = new OpenLayers.Bounds.fromString(param[1]);
									}catch(e){
										bbox = undefined;
									} 
									break;
					default :       
									//mapIdentifier = -1;
									//authorization = false;
									//fullScreen = false; 
				}
			}
        }		
		
        var onReady = function(){
                Ext.QuickTips.init();
 
            var tbar = ["->",
                      {
                        ref:'user',
                        xtype: 'textfield',
                        emptyText: 'Username',
                        name: 'username'
                      },{
                        ref:'pass',
                        xtype: 'textfield',
                        inputType: 'password',
                        emptyText: 'Password',
                        name: 'password'
                      },{
                      
                      xtype: 'button',
                      text: 'Log In',
                      iconCls: 'login',
                      ref: 'login',
                      handler: function(btn){
                            //go to the main page
                            var pass = btn.refOwner.pass.getValue();
                            var user = btn.refOwner.user.getValue();
                            
                            Ext.Ajax.request({
                                url: loginService,
                                scope: this,
                                params : {
                                    j_username: username,
                                    j_password: password
                                },
                                headers : {
                                    "Content-Type" : "application/x-www-form-urlencoded"
                                },
                                success: function(response, form, action) {
                                    // we check if the response include the 'adminLoginInvalidResponseValidator' string
                                    this.loginSuccess(response.responseText 
                                        && response.responseText.indexOf(this.adminLoginInvalidResponseValidator) < 0);
                                },
                                failure: function(response, form, action) {
                                    // maybe is not admin!!
                                    this.loginSuccess(false);
                                }
                            });
                            
                          }
                        },{
                          width: 100,
                          xtype: 'box',
                          autoEl: {
                            children: [{
                              tag: 'a',
                              href: '#',
                              cn: 'forgot password?'
                            }]
                          },
                      listeners: {
                        render: function(c){
                          c.el.select('a').on('click', function(){
                                Ext.Msg.alert("To be implemented","this feature is missing");
                          });
                        }
                      }
                    }];
            var appTabs={
                xtype:'panel',region:'center',
                tbar: tbar,
                html:'<img id="logo" src="theme/app/img/logo.png" alt="Rextag, a Hart Energy Company" style="opacity:0.45;filter:alpha(opacity=45);left:50%;top:50%;width:940px;height: 279px;margin-top:-140px;margin-left:-470px;position:absolute;">'
            }
			var iframe = "<iframe style='border: none; height: 100%; width: 100%' src='about.html' frameborder='0' border='0'>" + 
						 "<a target='_blank' href='about.html'>" + GeoExplorer.prototype.aboutText + "</a> </iframe>";
						 
            var aboutButton = new Ext.Button({
                text: GeoExplorer.prototype.appInfoText,
                iconCls: "icon-geoexplorer",
                handler: function(){
                    var appInfo = new Ext.Panel({
                        header: false,
                        html: iframe
                    });

                    var win = new Ext.Window({
                        title:  GeoExplorer.prototype.aboutThisMapText,
                        modal: true,
                        layout: "fit",
                        width: 360,
                        height: 360,
                        items: [appInfo]
                    });
                    
                    win.show();
                }
            });
            
            var poweredByGeoSol = new Ext.Button({
                tooltip: 'Powered by GeoSolutions',
                iconCls: "icon-geosol",
                width : 150,
                handler: function(btn){
                    window.open('http://www.geo-solutions.it/about/contacts/', '_blank');
                }
            });    
			var headerContent = [
					'<div id="headerbanner" style="background-color:black">',
					'<div id="left-banner"><img src="theme/app/img/banner/banner_left.png"   height="86" border="0" /> </div>',
					'<div id="right-banner"><img src="theme/app/img/banner/banner_right.png"  style="float:right"  border="0" /></div>',
					'</div>'
				];
			var header = {
                border: false,
                header: false,
                html:  headerContent,
                region: 'north',
                collapsible: true,
                collapseMode:  'mini',
                hideCollapseTool: true,
                split: true,
                animCollapse : false,
                bodyStyle:"background-color:black",
                minHeight: 86,
                maxHeight: 86,
                height: 86,
                id : 'HeaderTopBanner'
            };
            
            var appViewport = new Ext.Viewport({
                id: 'appVieport',
                layout:'fit',
                border:false,
                items: [{
                    region : 'center',
                    layout : 'border',
                    border : false,
                    header : false,
                    items : [header,appTabs],
                    
                    bbar : [
                      poweredByGeoSol, ' ', aboutButton, '->'
                    ]
                }]
            });
                                
                                
		   
	    };

	    Ext.onReady(onReady);
    </script>
    
	<div style="visibility:hidden"><canvas id="printcanvas" /></div>
